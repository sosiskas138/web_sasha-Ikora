# Sasha AI Webhook ‚Üí Bitrix24

–í–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–µ–º–∞ –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç Sasha AI –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Bitrix24.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ü—Ä–∏–µ–º –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç Sasha AI (—Å–æ–±—ã—Ç–∏—è `call_result`)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ HMAC SHA-256 –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ Bitrix24
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–æ–≤ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–∞–ø–ø–∏–Ω–≥–∞ –ø–æ–ª–µ–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ Health check endpoint

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env`:
```bash
cp .env.example .env
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `.env`:
   - `WEBHOOK_SECRET` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –≤–µ–±—Ö—É–∫–∞ –∏–∑ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Sasha AI
   - `BITRIX_WEBHOOK_URL` - URL –≤–µ–±—Ö—É–∫–∞ –≤–∞—à–µ–≥–æ Bitrix24

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤–µ–±—Ö—É–∫–∞ Sasha AI

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **–ö–æ–ª–ª-–ª–∏—Å—Ç—ã** –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Sasha AI
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –∫–æ–ª–ª-–ª–∏—Å—Ç
3. –í –±–ª–æ–∫–µ **–í–µ–±—Ö—É–∫–∏** –Ω–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –≤–µ–±—Ö—É–∫**
4. –£–∫–∞–∂–∏—Ç–µ URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞: `https://your-domain.com/webhook`
5. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è: **–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–≤–æ–Ω–∫–∞**
6. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** - –æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Bitrix24

1. –°–æ–∑–¥–∞–π—Ç–µ –≤—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫ –≤ Bitrix24:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CRM ‚Üí –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º ‚Üí –î—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –í—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –≤–µ–±—Ö—É–∫ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ CRM
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –≤–µ–±—Ö—É–∫–∞ (—Ñ–æ—Ä–º–∞—Ç: `https://your-domain.bitrix24.ru/rest/1/webhook_code/`)

2. –£–∫–∞–∂–∏—Ç–µ URL –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `BITRIX_WEBHOOK_URL`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ –ø–æ–ª–µ–π

–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏ –≤ Bitrix24 –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Sasha AI:

- **–ö–æ–Ω—Ç–∞–∫—Ç—ã** - —Å–æ–∑–¥–∞—é—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- **–°–¥–µ–ª–∫–∏** - —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (`isCommit: true`)
- **–õ–∏–¥—ã** - —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, –Ω–æ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

#### üéØ –°–∏—Å—Ç–µ–º–∞ –∞–ª–∏–∞—Å–æ–≤ –ø–æ–ª–µ–π

–í–º–µ—Å—Ç–æ –¥–ª–∏–Ω–Ω—ã—Ö ID —Ç–∏–ø–∞ `UF_CRM_6899EA70F16BE` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞!

**–§–∞–π–ª `bitrix-fields.js`** —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–ª–∏–∞—Å—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π. –ù–∞–ø—Ä–∏–º–µ—Ä:
- `firstName` ‚Üí `UF_CRM_6899EA70F16BE`
- `lastName` ‚Üí `UF_CRM_6899EA7121D5F`
- `phone` ‚Üí `UF_CRM_6899EA70D1AF5`
- `email` ‚Üí `UF_CRM_6899EA70B2CCA`

#### –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–ø–ø–∏–Ω–≥–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `mapping.js` –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª–∏–∞—Å—ã –≤–º–µ—Å—Ç–æ –¥–ª–∏–Ω–Ω—ã—Ö ID:

```javascript
const dealMapping = {
  // –ë–∞–∑–æ–≤—ã–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ –∞–ª–∏–∞—Å—ã
  'title': (data) => `–ó–∞—è–≤–∫–∞: ${data.call?.agreements?.agreements}`,
  'category': 28,
  'stage': 'NEW',
  
  // –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ –ø–æ–Ω—è—Ç–Ω—ã–µ –∞–ª–∏–∞—Å—ã!
  'firstName': (data) => {
    const name = data.call?.agreements?.client_name || '';
    return name.split(' ')[0] || '';
  },
  'lastName': (data) => {
    const name = data.call?.agreements?.client_name || '';
    return name.split(' ').slice(1).join(' ') || '';
  },
  'phone': 'contact.phone',
  'email': 'contact.additionalFields.email',
  'city': 'contact.additionalFields.city',
  'motivation': 'call.agreements.interest_level',
  'opportunity': 10000,
};
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–∏–∞—Å–æ–≤ –ø–æ–¥ –≤–∞—à–∏ –ø–æ–ª—è

1. **–û—Ç–∫—Ä–æ–π—Ç–µ `bitrix-fields.js`** –∏ –Ω–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –∞–ª–∏–∞—Å—ã
2. **–ó–∞–º–µ–Ω–∏—Ç–µ ID –ø–æ–ª–µ–π** –Ω–∞ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ ID –∏–∑ Bitrix
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª–∏–∞—Å—ã** –≤ `mapping.js` –≤–º–µ—Å—Ç–æ –¥–ª–∏–Ω–Ω—ã—Ö ID

–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `bitrix-fields.js`:
```javascript
const dealFields = {
  'firstName': 'UF_CRM_6899EA70F16BE',  // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à ID
  'lastName': 'UF_CRM_6899EA7121D5F',   // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à ID
  // ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
};
```

#### –ö–∞–∫ —É–∑–Ω–∞—Ç—å ID –ø–æ–ª–µ–π –≤ Bitrix

1. **–ß–µ—Ä–µ–∑ REST API:**
```bash
curl -X POST "https://your-domain.bitrix24.ru/rest/1/webhook_code/crm.deal.fields"
```

2. **–ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí CRM ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–µ–π ‚Üí –°–¥–µ–ª–∫–∏/–ö–æ–Ω—Ç–∞–∫—Ç—ã

3. **–ò–∑ URL –∑–∞–ø—Ä–æ—Å–∞:** –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ (–∫–∞–∫ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ), ID –ø–æ–ª–µ–π –≤–∏–¥–Ω—ã –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö `FIELDS[UF_CRM_...]`

#### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω** ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ç–∞–∫—Ç
2. **–ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å** (`isCommit: true`) ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–¥–µ–ª–∫–∞, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º
3. **–ï—Å–ª–∏ –Ω–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, –Ω–æ –µ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏–¥, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º
4. **–ö –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ** –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ timeline —Å –¥–µ—Ç–∞–ª—è–º–∏ –∑–≤–æ–Ω–∫–∞

## –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

#### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π):
```bash
npm run dev
```

#### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º:
```bash
npm start
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:3000`

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

#### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å docker-compose:

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Å–º. —Ä–∞–∑–¥–µ–ª "–£—Å—Ç–∞–Ω–æ–≤–∫–∞")
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
docker-compose up -d
```

3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
docker-compose logs -f
```

4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
docker-compose down
```

#### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker –Ω–∞–ø—Ä—è–º—É—é:

1. –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑:
```bash
docker build -t sasha-webhook-bitrix .
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
docker run -d \
  --name sasha-webhook-bitrix \
  -p 3000:3000 \
  --env-file .env \
  --restart unless-stopped \
  sasha-webhook-bitrix
```

3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
docker logs -f sasha-webhook-bitrix
```

4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
docker stop sasha-webhook-bitrix
docker rm sasha-webhook-bitrix
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ health check:
```bash
curl http://localhost:3000/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—Ç–≤–µ—Ç:
```json
{
  "status": "ok",
  "timestamp": "2025-01-16T10:00:00.000Z",
  "service": "sasha-webhook-to-bitrix"
}
```

## Endpoints

### POST /webhook
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–µ–±—Ö—É–∫–∏ –æ—Ç Sasha AI.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
- `X-Webhook-Signature` - HMAC SHA-256 –ø–æ–¥–ø–∏—Å—å
- `X-Webhook-ID` - ID —Å–æ–±—ã—Ç–∏—è
- `X-Webhook-Timestamp` - –í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è
- `X-Call-List-ID` - ID –∫–æ–ª–ª-–ª–∏—Å—Ç–∞

**–û—Ç–≤–µ—Ç:** HTTP 200 OK —Å JSON –æ–±—ä–µ–∫—Ç–æ–º

### GET /health
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞.

**–û—Ç–≤–µ—Ç:** HTTP 200 OK —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞—Ç—É—Å–µ

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å ngrok (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ–±—Ö—É–∫–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok:

```bash
ngrok http 3000
```

–ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://abc123.ngrok.io/webhook`) –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–µ–±—Ö—É–∫–∞ –≤ Sasha AI.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∞–ø–ø–∏–Ω–≥

–°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç Sasha AI –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏—Ö –≤ —Å—É—â–Ω–æ—Å—Ç–∏ Bitrix24:

### –î–∞–Ω–Ω—ã–µ –æ—Ç Sasha AI:
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è** (id, type, timestamp, organizationId)
- **–î–∞–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–∞** (id, status, duration, startedAt, connectedAt, endedAt)
- **–î–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏** (isCommit, agreements, client_name, client_facts, interest_level)
- **–î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞** (id, phone, tags, additionalFields)
- **–î–∞–Ω–Ω—ã–µ –∫–æ–ª–ª-–ª–∏—Å—Ç–∞** (id, name, status)

### –ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ Bitrix:

**–ö–æ–Ω—Ç–∞–∫—Ç:**
- –ò–º—è –∏–∑ `call.agreements.client_name`
- –¢–µ–ª–µ—Ñ–æ–Ω –∏–∑ `contact.phone`
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ `call.agreements.agreements`

**–°–¥–µ–ª–∫–∞** (–µ—Å–ª–∏ `isCommit: true`):
- –ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
- –°—Ç–∞–¥–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `interest_level`
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å —Ñ–∞–∫—Ç–∞–º–∏ –æ –∫–ª–∏–µ–Ω—Ç–µ
- –°–≤—è–∑—å —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º

**–õ–∏–¥** (–µ—Å–ª–∏ –Ω–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏):
- –ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–≤–æ–Ω–∫–µ
- –î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- –°–≤—è–∑—å —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º

–í—Å–µ –ø–æ–ª—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `mapping.js`.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ HMAC SHA-256 (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `WEBHOOK_SECRET`)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `timingSafeEqual` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç timing attacks
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –∞—É–¥–∏—Ç–∞

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –í–µ–±—Ö—É–∫ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –≤–µ–±—Ö—É–∫–∞ —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `WEBHOOK_SECRET` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—ã—Ä–æ–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–µ –ø–∞—Ä—Å–∏—Ç—Å—è –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏)

### –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Bitrix
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `BITRIX_WEBHOOK_URL`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ–±—Ö—É–∫ Bitrix24 –∏–º–µ–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏

## –õ–∏—Ü–µ–Ω–∑–∏—è

ISC
